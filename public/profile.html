<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - Course Health</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/auth.js"></script>
    <style>
        .profile-page {
            padding: 140px 0 60px;
            min-height: 100vh;
        }
        
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .profile-header {
            background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.05));
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-electric));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto 20px;
            border: 4px solid var(--glass-border);
        }
        
        .profile-name {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-white);
            margin-bottom: 10px;
        }
        
        .profile-username {
            color: var(--text-gray);
            font-size: 16px;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent-electric);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-gray);
            font-size: 14px;
        }
        
        .profile-menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .menu-item {
            background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.05));
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            text-decoration: none;
            color: var(--text-white);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
            border-color: var(--accent-electric);
            box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2);
        }
        
        .menu-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 217, 255, 0.1);
            border-radius: 12px;
        }
        
        .menu-content h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .menu-content p {
            font-size: 13px;
            color: var(--text-gray);
        }
        
        .logout-btn {
            width: 100%;
            padding: 16px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 16px;
            color: var(--accent-flame);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .profile-menu {
                grid-template-columns: 1fr;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="burger-menu" id="burgerMenu" aria-label="–ú–µ–Ω—é">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <a href="/index.html" class="logo" style="text-decoration: none; color: inherit;">
                        <span class="logo-icon">üíö</span>
                        <span class="logo-text">Course Health</span>
                    </a>
                </div>
                <ul class="nav-links">
                    <li><a href="/index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="/courses.html">–ö—É—Ä—Å—ã</a></li>
                    <li><a href="/reviews.html">–û—Ç–∑—ã–≤—ã</a></li>
                    <li><a href="/promotions.html">–ê–∫—Ü–∏–∏</a></li>
                </ul>
                <div class="nav-actions">
                    <div id="authButtons" style="display: none;">
                        <a href="/profile.html" class="btn-primary">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                    </div>
                    <div id="guestButtons">
                        <a href="/login.html" class="btn-primary">–í–æ–π—Ç–∏</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <div class="mobile-menu-logo">
                <span class="logo-icon">üíö</span>
                <span class="logo-text">Course Health</span>
            </div>
            <button class="mobile-menu-close" id="mobileMenuClose">‚Üê</button>
        </div>
        <ul class="mobile-menu-links">
            <li><a href="/index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/courses.html">–ö—É—Ä—Å—ã</a></li>
            <li><a href="/reviews.html">–û—Ç–∑—ã–≤—ã</a></li>
            <li><a href="/promotions.html">–ê–∫—Ü–∏–∏</a></li>
            <li id="mobileProfileLink" style="display: none;"><a href="/profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
            <li id="mobileWalletLink" style="display: none;"><a href="/profile.html#wallet">–ö–æ—à–µ–ª–µ–∫</a></li>
            <li id="mobileEarnLink" style="display: none;"><a href="/promotions.html#referral">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</a></li>
            <li id="mobileLogoutLink" style="display: none;"><a href="#" onclick="logout(); return false;">–í—ã–π—Ç–∏</a></li>
        </ul>
    </div>

    <!-- Profile Page -->
    <section class="profile-page">
        <div class="container">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <h1 class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                    <div class="profile-username" id="profileUsername">@username</div>
                    
                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="coursesCount">0</div>
                            <div class="stat-label">–ö—É—Ä—Å–æ–≤ –∫—É–ø–ª–µ–Ω–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="balanceAmount">0 ‚ÇΩ</div>
                            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="referralsCount">0</div>
                            <div class="stat-label">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
                        </div>
                    </div>
                </div>

                <div class="profile-menu">
                    <button onclick="openMyCoursesModal()" class="menu-item" style="border: none; background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.05)); cursor: pointer;">
                        <div class="menu-icon">üìö</div>
                        <div class="menu-content">
                            <h3>–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
                            <p>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</p>
                        </div>
                    </button>
                    
                    <button onclick="openWalletModal()" class="menu-item" style="border: none; background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.05)); cursor: pointer;">
                        <div class="menu-icon">üí∞</div>
                        <div class="menu-content">
                            <h3>–ö–æ—à–µ–ª–µ–∫</h3>
                            <p>–ë–∞–ª–∞–Ω—Å –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</p>
                        </div>
                    </button>
                    
                    <button onclick="openReferralModal()" class="menu-item" style="border: none; background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.05)); cursor: pointer;">
                        <div class="menu-icon">üíé</div>
                        <div class="menu-content">
                            <h3>–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</h3>
                            <p>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</p>
                        </div>
                    </button>
                    
                </div>

                <button class="logout-btn" onclick="logout()">
                    –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </button>
            </div>
        </div>
    </section>

    <script src="/js/main.js"></script>
    <script>
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Next.js –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ñ–∏–ª—è, –≥–¥–µ –µ—Å—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        // –≠—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É, –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if (window.location.pathname === '/profile.html' || window.location.pathname === '/profile.html/') {
            window.location.replace('/profile');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        if (!isAuthenticated()) {
            window.location.href = '/login.html';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
        document.addEventListener('DOMContentLoaded', function() {
            const user = getUserData();
            
            if (user.id) {
                document.getElementById('profileName').textContent = user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('profileUsername').textContent = '@' + (user.username || 'user');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –ë–î
                loadProfileStats(user.id);
            } else {
                window.location.href = '/login.html';
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadProfileStats(userId) {
            try {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage
                const purchasedCourses = JSON.parse(localStorage.getItem('purchased_courses') || '[]');
                document.getElementById('coursesCount').textContent = purchasedCourses.length;
                
                // –ë–∞–ª–∞–Ω—Å –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ API –ø–æ–∑–∂–µ
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
    </script>
</body>
</html>
